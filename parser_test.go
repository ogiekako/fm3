package fm3

import (
	"testing"
	"strings"
)

func TestParse1(t *testing.T) {
	lines := []string {
		"ばか詰 15手",
		"",
		"９ ８ ７ ６ ５ ４ ３ ２ １             ９ ８ ７ ６ ５ ４ ３ ２ １",
		"+---------------------------+          +---------------------------+",
		"| ・ ・ ・ ・ ・ ・ ・ 金 金|一        | ・ ・ ・ ・ ・ ・ ・ 金 金|一",
		"| ・ ・ ・ ・v玉 ・ 金 ・ 金|二        | ・ ・ ・ ・ ・ ・ ・v玉 ・|二",
		"| ・ ・ ・ ・ ・ ・ ・ ・ ・|三        | ・ ・ ・ ・ ・ 金 ・ ・ ・|三",
		"| ・ ・ ・ ・ ・ ・ ・ ・ ・|四        | ・ ・ ・ ・ ・ ・ ・ ・ 金|四",
		"| ・ ・ ・ ・ ・ ・ ・ ・ ・|五        | ・ ・ ・ ・ ・ ・ ・ ・ ・|五",
		"| ・ ・ ・ ・ ・ ・ ・ ・ ・|六        | ・ ・ ・ ・ ・ ・ ・ ・ ・|六",
		"| ・ ・ ・ ・ ・ ・ ・ ・ ・|七        | ・ ・ ・ ・ ・ ・ ・ ・ ・|七",
		"| ・ ・ ・ ・ ・ ・ ・ ・ ・|八        | ・ ・ ・ ・ ・ ・ ・ ・ ・|八",
		"| ・ ・ ・ ・ ・ ・ ・ ・ ・|九        | ・ ・ ・ ・ ・ ・ ・ ・ ・|九",
		"+---------------------------+          +---------------------------+",
		"持駒：なし                             持駒：なし",
	}
	probs := Parse(lines)
	if len(probs) != 1 {
		t.Errorf("got: %d  want: 1", len(lines))
	}
	wantB := NewCircum()
	wantB.Hither = true
	wantB.Board[1][1] = &Piece {
		Hither: true,
		Name: KI,
	}
	wantB.Board[1][2] = &Piece {
		Hither: true,
		Name: KI,
	}
	wantB.Board[2][1] = &Piece {
		Hither: true,
		Name: KI,
	}
	wantB.Board[3][2] = &Piece {
		Hither: true,
		Name: KI,
	}
	wantB.Board[5][2] = &Piece {
		Hither: false,
		Name: OU,
	}
	want := &Prob {
		step: 15,
		board: wantB,
	}
	if probs[0].step != want.step {
		t.Error("got: %d  want: %d", probs[0].step, want.step)
	}
	if probs[0].board.hash() != want.board.hash() {
		t.Errorf("got: %s\nwant: %s", probs[0].board, want.board)
	}
}

func TestParseMulti(t *testing.T) {
	text := `
	金１色詰で、金が連結した形から選題

----

ばか詰 11手

  ９ ８ ７ ６ ５ ４ ３ ２ １             ９ ８ ７ ６ ５ ４ ３ ２ １
+---------------------------+          +---------------------------+
| ・ ・ ・ ・ ・ ・ ・ ・ ・|一        | ・ ・ ・ ・ ・ ・ ・ ・ ・|一
| ・ ・ ・ ・ ・ ・ ・ ・ ・|二        | ・ ・ ・ ・ ・ ・ ・ ・ ・|二
| ・ ・ ・ ・ ・ ・ ・ ・ ・|三        | ・ ・ ・ ・ ・ ・ ・ ・ ・|三
| ・ ・ ・ ・ ・ ・ ・ ・ ・|四        | ・ ・ ・ ・ ・ ・ ・ ・ ・|四
| ・ ・ ・ ・v玉 ・ ・ 金 ・|五        | ・ ・ ・ 金 金 ・ ・ ・ ・|五
| ・ ・ ・ ・ ・ ・ 金 ・ ・|六        | ・ ・ ・ ・v玉 ・ 金 ・ ・|六
| ・ ・ ・ ・ ・ 金 ・ ・ ・|七        | ・ ・ ・ ・ ・ ・ ・ ・ ・|七
| ・ ・ ・ ・ 金 ・ ・ ・ ・|八        | ・ ・ ・ ・ 金 ・ ・ ・ ・|八
| ・ ・ ・ ・ ・ ・ ・ ・ ・|九        | ・ ・ ・ ・ ・ ・ ・ ・ ・|九
+---------------------------+          +---------------------------+
持駒：なし                             持駒：なし

46金直 44玉 35金寄 54玉 45金寄 65玉 55金上 66玉 65金 56玉
55金右 まで 11手

▼神無七郎
金１色での代表的な詰上り。金１色・連結型の条件では左真樹氏の17手詰が有
名だが、それもこの詰上りである。



-----2

ばか詰 13手

  ９ ８ ７ ６ ５ ４ ３ ２ １             ９ ８ ７ ６ ５ ４ ３ ２ １
+---------------------------+          +---------------------------+
| ・ ・ ・ ・ ・ ・ ・ ・ ・|一        | ・ ・ ・ ・ ・ ・ ・ ・ ・|一
| ・ ・ ・ ・ ・ ・ ・ ・ ・|二        | ・ ・ ・ ・ ・ ・ ・ ・ ・|二
| ・ ・ ・ ・ ・ ・ ・ ・ ・|三        | ・ ・ ・ ・ ・ ・ ・ ・ ・|三
| ・ ・ ・ ・ ・ ・ ・ ・v玉|四        | ・ ・ ・ ・ ・ ・ ・ ・ ・|四
| ・ ・ ・ ・ ・ ・ ・ ・ ・|五        | ・ ・ ・ ・ ・ ・ ・ ・ ・|五
| ・ ・ ・ ・ ・ ・ ・ ・ 金|六        | ・ ・ ・ ・ ・ ・ ・ ・ ・|六
| ・ ・ ・ ・ ・ ・ ・ ・ 金|七        | ・ ・ ・ ・ ・ ・ ・ ・ ・|七
| ・ ・ ・ ・ ・ ・ ・ ・ 金|八        | ・ ・ ・ ・ ・ ・ 金 金 金|八
| ・ ・ ・ ・ ・ ・ ・ ・ 金|九        | ・ ・ ・ ・ ・ ・ ・v玉 ・|九
+---------------------------+          +---------------------------+
持駒：なし                             持駒：なし

25金 同玉 16金 36玉 26金 37玉 27金引 38玉 28金上 39玉
38金 29玉 28金引 まで 13手

▼神無七郎
３金で綺麗に詰上がる。
この詰上りを中央で実現しようとすると、形が直線型にならない。



-----3

ばか詰 13手

  ９ ８ ７ ６ ５ ４ ３ ２ １             ９ ８ ７ ６ ５ ４ ３ ２ １
+---------------------------+          +---------------------------+
| ・ ・ ・ ・ ・ ・ ・ ・ ・|一        | ・ ・ ・ ・ ・ ・ ・ ・ ・|一
| ・ ・ ・ ・ ・ ・ ・ ・ ・|二        | ・ ・ ・ ・ ・ ・ ・ ・ ・|二
| ・ ・ ・ ・ ・ ・ ・ ・ ・|三        | ・ ・ ・ ・ ・ ・ ・ ・ ・|三
| ・ ・ ・ ・ ・ ・ ・ ・v玉|四        | ・ ・ ・ ・ ・ ・ ・ ・ ・|四
| ・ ・ ・ ・ ・ ・ ・ ・ ・|五        | ・ ・ ・ ・ ・ ・ ・ ・ ・|五
| ・ ・ ・ ・ ・ ・ ・ 金 ・|六        | ・ ・ ・ ・ ・ ・ ・ ・ ・|六
| ・ ・ ・ ・ ・ ・ ・ 金 ・|七        | ・ ・ ・ ・ ・ ・ ・ ・ ・|七
| ・ ・ ・ ・ ・ ・ ・ 金 ・|八        | ・ ・ ・ ・ ・ ・ ・ 金 金|八
| ・ ・ ・ ・ ・ ・ ・ 金 ・|九        | ・ ・ ・ ・ ・ ・ ・ ・v玉|九
+---------------------------+          +---------------------------+
持駒：なし                             持駒：なし

25金 同玉 16金 36玉 27金 同玉 38金 18玉 17金 29玉
28金 19玉 18金引 まで 13手

▼神無七郎
前作の姉妹作。金を２枚捨てるのが意表を突く。
玉が隅に入る詰上りは、金が38にあって、17から玉が潜り込む形が多い。他の入
り方だと非限定が生じるからである。この作は最初から38に金が居るのではなく、
動いて38に行くようになっている。この点でも珍しい作である。



-----4

ばか詰 13手

  ９ ８ ７ ６ ５ ４ ３ ２ １             ９ ８ ７ ６ ５ ４ ３ ２ １
+---------------------------+          +---------------------------+
| ・ ・ ・ ・ ・ ・ ・ ・ ・|一        | ・ ・ ・ ・ ・ ・ ・ ・ ・|一
| ・ ・ ・ ・ ・ ・ ・ ・ ・|二        | ・ ・ ・ ・ ・ ・ ・ ・ ・|二
| ・ ・ ・ ・ ・ ・ ・ ・ ・|三        | ・ ・ ・ ・ ・ ・ ・ ・ ・|三
| ・ ・ ・ ・ ・ ・ ・ ・ ・|四        | ・ ・ ・ ・ ・ ・ ・ ・ ・|四
| ・ ・ ・ ・ ・ ・ ・ ・ ・|五        | ・ ・ ・ ・ ・ ・ ・ ・ ・|五
| ・ ・ ・ ・ 金 ・ ・ ・ ・|六        | ・ ・ ・ ・ ・ ・ ・ ・ ・|六
| ・ ・ ・ 金 金 ・ ・ ・ ・|七        | ・ ・ ・ ・ ・ ・ ・ ・ ・|七
| ・ ・ ・ ・ 金 ・v玉 ・ ・|八        | ・ ・ ・ 金 金 ・ ・ ・ ・|八
| ・ ・ ・ ・ ・ ・ ・ ・ ・|九        | ・ ・ ・ ・v玉 ・ 金 ・ ・|九
+---------------------------+          +---------------------------+
持駒：なし                             持駒：なし

48金 39玉 38金 49玉 39金 59玉 58金 同玉 57金引 69玉
68金 59玉 58金引 まで 13手

▼神無七郎
この詰上りでは、たいてい金１枚が不要駒になる。本局は金捨てが入って、不要
駒のない完全作になっている。



-----5

ばか詰 13手

  ９ ８ ７ ６ ５ ４ ３ ２ １             ９ ８ ７ ６ ５ ４ ３ ２ １
+---------------------------+          +---------------------------+
| ・ ・ ・ ・ ・ ・ ・ ・ ・|一        | ・ ・ ・ ・ ・ ・ ・ ・ ・|一
| ・ ・ ・ ・ ・ ・ ・ ・ ・|二        | ・ ・ ・ ・ ・ ・ ・ ・ ・|二
| ・ ・ ・ ・ ・ ・ ・ ・ ・|三        | ・ ・ ・ ・ ・ ・ ・ ・ ・|三
| ・ ・ ・ 金 ・ 金 ・ ・ ・|四        | ・ ・ ・ 金 金 ・ ・ ・ ・|四
| ・ ・ ・ ・ 金 ・ ・ ・ ・|五        | ・ ・ ・ ・v玉 ・ 金 ・ ・|五
| ・ ・ ・ ・ 金 ・ ・ ・ ・|六        | ・ ・ ・ ・ ・ ・ ・ ・ ・|六
| ・ ・ ・ ・ ・ ・ ・ ・ ・|七        | ・ ・ ・ ・ 金 ・ ・ ・ ・|七
| ・ ・ ・ ・v玉 ・ ・ ・ ・|八        | ・ ・ ・ ・ ・ ・ ・ ・ ・|八
| ・ ・ ・ ・ ・ ・ ・ ・ ・|九        | ・ ・ ・ ・ ・ ・ ・ ・ ・|九
+---------------------------+          +---------------------------+
持駒：なし                             持駒：なし

57金 48玉 58金 37玉 48金 46玉 45金寄 36玉 35金 46玉
57金 55玉 54金右 まで 13手

▼神無七郎
「Ｙ字型」。詰上りは例の形である。ジグザグ型や「ｙ型」もこの詰上りの完全
作がある。



-----6

ばか詰 15手

  ９ ８ ７ ６ ５ ４ ３ ２ １             ９ ８ ７ ６ ５ ４ ３ ２ １
+---------------------------+          +---------------------------+
| ・ ・ ・ ・ ・ ・ ・ 金 金|一        | ・ ・ ・ ・ ・ ・ ・ 金 金|一
| ・ ・ ・ ・v玉 ・ 金 ・ 金|二        | ・ ・ ・ ・ ・ ・ ・v玉 ・|二
| ・ ・ ・ ・ ・ ・ ・ ・ ・|三        | ・ ・ ・ ・ ・ 金 ・ ・ ・|三
| ・ ・ ・ ・ ・ ・ ・ ・ ・|四        | ・ ・ ・ ・ ・ ・ ・ ・ 金|四
| ・ ・ ・ ・ ・ ・ ・ ・ ・|五        | ・ ・ ・ ・ ・ ・ ・ ・ ・|五
| ・ ・ ・ ・ ・ ・ ・ ・ ・|六        | ・ ・ ・ ・ ・ ・ ・ ・ ・|六
| ・ ・ ・ ・ ・ ・ ・ ・ ・|七        | ・ ・ ・ ・ ・ ・ ・ ・ ・|七
| ・ ・ ・ ・ ・ ・ ・ ・ ・|八        | ・ ・ ・ ・ ・ ・ ・ ・ ・|八
| ・ ・ ・ ・ ・ ・ ・ ・ ・|九        | ・ ・ ・ ・ ・ ・ ・ ・ ・|九
+---------------------------+          +---------------------------+
持駒：なし                             持駒：なし

42金 53玉 52金 43玉 53金 32玉 31金 23玉 13金 24玉
14金 33玉 43金 22玉 21金左 まで 15手

▼神無七郎
例の形と比べ、上を押さえる金の位置がずれている。15手詰は25局あるが、ほと
んど中段玉か入玉型である。



-----7

ばか詰 17手

  ９ ８ ７ ６ ５ ４ ３ ２ １             ９ ８ ７ ６ ５ ４ ３ ２ １
+---------------------------+          +---------------------------+
| 金 金 金 ・ ・ ・ ・ ・ ・|一        | 金 ・v玉 ・ ・ ・ ・ ・ ・|一
| ・ ・ ・ 金 ・v玉 ・ ・ ・|二        | ・ ・ ・ 金 ・ ・ ・ ・ ・|二
| ・ ・ ・ ・ ・ ・ ・ ・ ・|三        | ・ ・ 金 ・ ・ ・ ・ ・ ・|三
| ・ ・ ・ ・ ・ ・ ・ ・ ・|四        | ・ ・ ・ ・ ・ ・ ・ ・ ・|四
| ・ ・ ・ ・ ・ ・ ・ ・ ・|五        | ・ ・ ・ ・ ・ ・ ・ ・ ・|五
| ・ ・ ・ ・ ・ ・ ・ ・ ・|六        | ・ ・ ・ ・ ・ ・ ・ ・ ・|六
| ・ ・ ・ ・ ・ ・ ・ ・ ・|七        | ・ ・ ・ ・ ・ ・ ・ ・ ・|七
| ・ ・ ・ ・ ・ ・ ・ ・ ・|八        | ・ ・ ・ ・ ・ ・ ・ ・ ・|八
| ・ ・ ・ ・ ・ ・ ・ ・ ・|九        | ・ ・ ・ ・ ・ ・ ・ ・ ・|九
+---------------------------+          +---------------------------+
持駒：なし                             持駒：なし

52金 43玉 42金 53玉 43金 62玉 72金 同玉 82金 73玉
83金 62玉 73金 61玉 52金 71玉 62金寄 まで 17手

▼神無七郎
わずか２局しかない17手詰のひとつ。長手数に拘らず、かなり異常なパターンで
ある。


【参考作品】

１色詰め作品は左真樹氏が多く発表しているが、金１色の完全作は次の２作。
最初の作は、この詰上り型で不要駒の発生しない珍しい例。
後の作は金１色の最長手数。初形も１直線で、金１色を代表する名作である。

----

79-9 左真樹

ばか詰 11手

  ９ ８ ７ ６ ５ ４ ３ ２ １             ９ ８ ７ ６ ５ ４ ３ ２ １
+---------------------------+          +---------------------------+
| ・ ・ ・ ・ ・ ・ ・ ・ ・|一        | ・ ・ ・ ・ ・ ・ ・ ・ ・|一
| ・ ・ ・ ・ ・ ・ ・ ・ ・|二        | ・ ・ ・ ・ ・ ・ ・ ・ ・|二
| ・ ・ ・ ・ ・ ・ ・ ・ ・|三        | ・ ・ ・ ・ ・ ・ ・ ・ ・|三
| ・ ・ ・ ・ ・ ・ ・ ・ ・|四        | ・ ・ ・ ・ ・ ・ ・ ・ ・|四
| ・ ・ ・ ・ ・ ・ ・ ・ ・|五        | ・ ・ ・ ・ ・ ・ ・ ・ ・|五
| ・ ・ ・ ・v玉 ・ ・ ・ ・|六        | ・ ・ ・ ・ ・ ・ ・ ・ ・|六
| ・ ・ ・ ・ ・ ・ ・ ・ ・|七        | ・ ・ ・ ・ ・ 金 ・ ・ ・|七
| ・ ・ ・ 金 金 金 ・ ・ ・|八        | ・ ・ 金 金 金 ・ ・ ・ ・|八
| ・ ・ ・ ・ 金 ・ ・ ・ ・|九        | ・ ・ ・v玉 ・ ・ ・ ・ ・|九
+---------------------------+          +---------------------------+
持駒：なし                             持駒：なし

47金直 66玉 57金左 77玉 67金寄 78玉 68金上 79玉 78金 69玉
68金引 まで 11手



80-3 左真樹(例題)

ばか詰 17手

  ９ ８ ７ ６ ５ ４ ３ ２ １             ９ ８ ７ ６ ５ ４ ３ ２ １
+---------------------------+          +---------------------------+
| ・ ・ ・ ・ ・ ・ ・ ・ ・|一        | ・ ・ ・ ・ ・ ・ ・ ・ ・|一
| ・ ・ ・ ・ ・ ・ ・ ・ ・|二        | ・ ・ ・ ・ ・ ・ ・ ・ ・|二
| ・ ・ ・ ・ ・ ・ ・ ・ ・|三        | ・ ・ ・ ・ ・ ・ ・ ・ ・|三
| ・ ・ ・ ・ 金 ・ ・ ・ ・|四        | ・ ・ ・ ・ ・ ・ ・ ・ ・|四
| ・ ・ ・ ・ 金 ・ ・ ・ ・|五        | ・ ・ ・ 金 金 ・ ・ ・ ・|五
| ・ ・ ・ ・ 金 ・ ・ ・ ・|六        | ・ ・ ・ ・v玉 ・ ・ ・ ・|六
| ・ ・ ・ ・ 金 ・ ・ ・ ・|七        | ・ ・ ・ ・ ・ ・ 金 ・ ・|七
| ・ ・ ・ ・ ・ ・ ・ ・ ・|八        | ・ ・ ・ ・ 金 ・ ・ ・ ・|八
| ・ ・ ・ ・v玉 ・ ・ ・ ・|九        | ・ ・ ・ ・ ・ ・ ・ ・ ・|九
+---------------------------+          +---------------------------+
持駒：なし                             持駒：なし

58金 49玉 59金 38玉 49金 47玉 46金 37玉 36金 47玉
37金 57玉 58金 66玉 65金 56玉 55金引 まで 17手

----


`
	probs := Parse(strings.Split(text, "\n"))
	if len(probs) != 9 {
		t.Errorf("got: %d  want: %d", len(probs), 9)
	}
}
